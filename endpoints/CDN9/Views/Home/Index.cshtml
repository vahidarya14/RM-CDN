@using CDN9.Core.Application
@inject IWebHostEnvironment hostEnvironment;
@model (List<D> Dires, List<D> files)
@{
    var baseurl = "home";
}

<input id="fullPathOffile" class="d-none" type="file" />
@* <div class="row justify-content-center">
	<div class="col-8">
		<input id="fullPathOfDir" class="form-control text-left ltr" readonly />
	</div>
</div> *@
<div class="container-fluid fm_sidebar overflow-hidden">
    <div class="row" style="height:100vh;">
        <div class="col-4 col-lg-3 px-0 py-2 position-relative border-end">
            @* <div class="border-bottom py-2" style="margin-left:-11px;margin-right:-11px;">
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" onclick="addDirectoryModal('','','mainDirecories')" class="btn btn-outline-dark ">➕Directory</button>
                </div>
            </div> *@
            <div class="" style="overflow-y: auto;
                                 height: 98vh;
                                 overflow-x: hidden;">
                <div class="" style="display:inline-flex">
                    @* <div class="dropdown">
                        <button class="btn btn-link btn-sm" type="button" data-bs-toggle="dropdown">
                            ⋮
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" onclick="showUploadModal('/','/','dir_-1')" href="#">📤Upload File</a></li>
                        </ul>
                    </div> *@
                    <label class="p-2 ps-0 d_-1" onclick="loadSub(-1,'/')" title="Root"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAADyUlEQVR4nO2YW4hVVRjHf5rjzJh2GUZtUlCcCZpCHBVv9OCLEw5CEOS9InvwoZesEIoUHa8R+JBmar34oM5kao7igyCFYFAZFKlZWjjNzEMQShbeL0e+4X+GNTP7svY5nnGfmD8s2Ht9972/9a1vLQjHBuAKkEnJuAKsIyFqUuB4JmSYb96YL6EW0oND8mleEqE1ErL0Sgs2yqfGJEIHJLSY9OBl+bQvidBvEqojPZgon876CpQBtzXKSQ/K5NMtoNRHYIIit7+SBAOB6cDbwBfAz0AHcFWjQ3N7gbeAacCAhDbOy7fxPsyLxWzrxAdPACuAP3IopSbzPjDS09ZByS3wYd4g5rUxfCXAO8C/jmMXgB3Aa1pfo5Se5XquE814Wh25y/qTJTE213v61okWj6ifBH5wHDGZWUovXxhvvbM/2DCdVREyi8S338fA7zF5+AzQJp7zciZf1Dv5/ydQG7N+f41TOAS4E1EZhkmJKTsBVHL/8DjwlfOBHs2nck2Wol9C6M2if+tbAhOiFPheNvbE7HH2d0LxqpisfPbEVNH+A8ZQOIyRjbv6sGFdx8IoJR+KaXUAbbtomz0dqlERuKTRkqBz3SJbnwTQ1ooW2dIfEdPcAFp2bdhG5oMzAfvGaU/ZGREpvkC0L6MUZGt7UNW4KlqFpzOnAwI55SlbIX6z2RPjRTsXJjxMeXkjZGNKGki1vpql1UU9V9+HQEpVtW6rivXCNAlbP0REalk/VWjMiKmeZ6O689dFbAoR3pZwseeDj2Vrawh9X9R5aZOI1gAGYUofld+xTvmdFMLTGHWCPSriixFGmsTzXYE2xDLgpGzsjuCbJx7rhnuhQ8SnIhQMdfLzmwK0KF87FemRCN5nnVamGx4T4RrwUIzBWjV2hWoaW4GnY/gHAzeDTrHPScmPnoarnBTIqBWvz6GNfx447Og5GdPGB2243dbRUk3uSuBIiQ5Dlx1H7Gt+CiyRgdHOwWq05oz2WY+D1T86/pYksL9Xsna70oWPNPkeyTFCctlzTJJh6fQuMDwHu6ukw+67unBMky+QOwaoQ14GfA78BLQ7lw/tmrOjwJsq50kvH1y85KR1F/7S5DiKB7Xy2TKhE5XObXeSxfqgMQi4rhPtwzYx06kYxYZTbuV6Qy87KT40y/dXUGNmL8spPqyU7x/Yy/EcymbaxmEL5O8UOJLvaMd5KVZksv73B5ISZPoD6SPM0WHPFnJDMQfS7vhmt/9h6A+kr9CgYCyI2cUciC/6A0kbMv+7QNpS0PTlO9osEKsIxRxMZ1W7B8kBdobJmr3KAAAAAElFTkSuQmCC" alt="hdd" height="16px"> /</label>
                </div>
                <div id="dir_-1" class="ms-3"></div>
                <div class="mainDirecories">
                 @*    @for (var i = 0; i < Model.Dires.Count; i++)
                    {
                        var item = Model.Dires[i];
                        <div class="" style="display:inline-flex">
                            <div class="dropdown">
                                <button class="btn btn-link btn-sm" type="button" data-bs-toggle="dropdown">
                                    ⋮
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" onclick="showUploadModal('@item.Path','/','dir_@i')" href="#">📤Upload File</a></li>
                                    <li><a class="dropdown-item" onclick="addDirectoryModal('@item.Path','@item.Text','dir_@i')" href="#">➕Sub Directory</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" onclick="removeDir('@item.Path','/','dir_@i')" href="#">🗑️Remove</a></li>
                                </ul>
                            </div>
                            <label class="p-2 ps-0 folder d_@i" onclick="loadSub(@i,'@item.Path')" title="@item.Text">@item.Text</label>
                        </div>
                        <div id="dir_@i" class="ms-3"></div>
                    } *@
                </div>
            </div>
        </div>
        <div class="col-8 col-lg-9 position-relative">
            <div class="border-bottom pt-1 px-2" style="margin-left:-11px;margin-right:-11px;padding-bottom: 3px;">
                <div class="row">
                    <div class="col-2 pt-2">
                        <label style="white-space: nowrap;">
                            <input type="checkbox" id="check_all_file" onchange="togglecheckAllByClass()" />
                            All
                        </label>
                    </div>
                    <div class="col">
                        <div class="input-group">
                            <input type="text" id="search_files" class="form-control" placeholder="search...">
                            <button class="btn btn-outline-secondary btn-sm input-group-text" onclick="loadSub('','')"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVR4nO3TL09CURjH8c8mQwvtMisNg29BOsFAMsDc6MxpcEYZDIIkNl+a78OMyZ3tCQbZvedeCDq+5YTzbN89f36c+Gv0scAy3lesMEXrEIIHzND+5e8a7+g1FQxKatrYoqg7otRBFTpY15Es9oxoH4+4lElacg5XGOdK5pn1F3g5tqSIQ8ki5SCHIW5yJdPIQVXe6gSzFUGrcmG3GKlJL4LWKRF8YqIBRQTtKc70HN3YwSY6SIKvpiIRtJSD57iitOSzH/8HE5Vxhx3u/41ogo9jS05ozDfB3x0cF9hxxwAAAABJRU5ErkJggg==" alt="search"></button>
                            <button class="btn btn-outline-secondary btn-sm input-group-text mx-1" onclick="showUploadModal(lastFolder,'/','dir_'+lastI0)"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7klEQVR4nO2Y24tNURzHP2Zcj0sT48yhyC1FFFHThFyKpvHiRSQ8zwOat+FNlEZR5A8YJEoZD+6J4uQaIYxcGqWExMxghinmaE3freU458y5rD1nn+xP7dpr771+v993r9tvLQgJCQkCg4EFwEZgG7AFWAMsBMopAaqBw8BXIJHm+gg0AzUEkAnASaDXCvgZcBw4CBwCWoCnSaJagOkEhGXAewX2GdgFTMrw/QxgJ9CpOu1ALUVmFfBdAZ0AojnUHa8WM3V/ApspErOBbwpkR542Bqmu6ZI9wGJ8IqKZZoW6hMcQ4IlE7HbgZ49smS5agUOmAceA7qTB2QqsBRpUvgaUOfBXBlyRzSYcUWsNRNN3HwBXgdeWINMVfgGzXDkF5smm+XlVLox1KdhmTas2NRLmTZ2uOS3b9YUauiFDe/sZN/Uu/loKNsn/BQpgvoy81GAuBlHF8KkQIw0OZ6FC6FYcI/KpvAS4JwNFW5hEm+KYSg5UWQPMS+js9aIYvFUs+4HVwND+Ksy0ptQ2DbS8mtMxj5PWrg9AY7pxOw54pQ9PAaMIDmOARcAGLco9ivNuqlzuqF5e8mGGiuaYPGaTZdyyMgsj9E+y16vVeyJuiclZq+5dMVzpUEKt1Mc+PTiAW2LaTNkbK5diYsAXNYLJQLgvR0t9FOGXmCa7EdpVGOuDiOQWcS2mWjbNzMYPFYb5ICJmCUn1rlAqZK/DFN6okGlfnS2PUgTqCSFJzEMH/kbKltmZclmFdQ4M31Fab/9tWwh6Z0TcduBvjmy/MIWtKpzBH5KFuKTR2itRae0AzVFOqQiJWHlYnfdwux68A6aUiJAjsntTpy99mPPX85aY5QEWErFEdCoz+YvRwDnL8VlgPTA5m9TZZyERYK7GhNedzKq+Ml2Fcn3ckeHQOd0Vz0NIPA8/CXWnf1oiFZU6+r+odcZLnTNd130U0gU81+xUZ4+JgcTP6XdACYUEjVBI0AiFBI14hjUmJCQk5D/lN23FLD07zTV6AAAAAElFTkSuQmCC" alt="upload-to-cloud--v1" height="20px"></button>
                            <button class="btn btn-outline-secondary btn-sm input-group-text" onclick="addDirectoryModal(lastFolder,lastFolder,'dir_'+lastI0)"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACK0lEQVR4nO2ZwU4UQRCGv+CCiciLKPHkRbgZ5YBRQ7K+hQHBB+AE6skTTwCcwUfRiLsh6g25KmKie6BNJf+Qdpyd7WGHnV7tL6lkd7s7Xf92VU33NCQSiVCmgFfAF8AFmPVbIkJeBgrwrQfcJjKO5NxcYP/X6t8FrhERThbKVeCdxmwxxkKMW8DPC4TksHYEvFBe1yLEeOiF5ahts04hTTDvrcxYCyn1958TctxQvFex4xAh42Z/kTXcIX7m/qscGRdcEhIZLgmJDJeERIZLQiLDJSGR4ZKQyHAxC5kE2sAO0AFOgR/AJ2AXeAK0YhfyGDgMOEh9Bh7EKGRC76iy+d8Dz4CbwLTMPq8CB1VOiKMmE/ELeApcKelrbct65xyVEAunM4m4V9D+Btgv+P2+J8bCrFEhk15O2EoUUebTipczrdBBl0Hby4l+4eRKfDLnP6i9HTroMtjVfPbP9sMN8GlN7dtVBtVNV/PdKOnjBvg0q/aPVQbVzYnmm/ES2wVaVgBm9P20SSHfckLMuVAhezkhJ00K6Wg+e9gNG1rdKoPqZkfz2RO7H26AT8+Lkj27dbJLlFGwpPkOhii/naLy6+93Rm3LFxCyqrZDPVzPmZKYJu4De9p25Nn3EttnQWNse/OISFj3xKzktxs5WlqJXtllaJNs6N91ypk1VaTrslkldrYlOZMIOwJEx12dBAeFoeVENOHUD6teiyrNb4GvwHethJVYq05/JHbGb3CG+sovxFVCAAAAAElFTkSuQmCC" alt="add-folder--v1" height="20px"></button>
                        </div>
                    </div>
                    <div class="col pt-2">
                        <button class="btn btn-outline-dark  btn-sm float-end me-4" id="select_all_and_close" onclick="getSelectedFilesandPushToParent()">push up <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVR4nN3SMQ4BURCA4W9bjZLoRbelO0jECWzNATQSl+EEWkdAKxHiAg6gRTaZQqHY3afyJ5OZN8n8eS9v+DFdbCM3Gj7jGbmWpIMTVnhhgQt6VQU7LKN+oBXnsl+J9kd9Q/9LvzIbzCQwwR5ZU0GGI6Ypt8hxxzBFMgpJkfKcHIeIOQbxxbXIMMYa19iTctn+hTfMuxhJ1kicJwAAAABJRU5ErkJggg==" alt="up3" height="16"></button>
                    </div>
                </div>
            </div>
            <div style="overflow: auto;position: absolute;padding: 0;
                        top: 42px;left: 0;right: 0;bottom: 24px;">
                <table id="files_" class="ml-3  w-100">
                 @*    @for (var i = 0; i < Model.files.Count; i++)
                    {
                        var f = Model.files[i];
                        var j = i;
                        <tr id="file_@j">
                            <td class="py-1 px-2" style="display:inline-flex">
                                <label style='white-space: nowrap;'>
                                    <input type="checkbox" value='@f.Path/@f.Text' class="_files" />
                                </label>
                                <label onclick="showFile2('@f.Path','@f.Text','@f.Extension')" id="file_lbl_@j" title="(@f.Length) - @f.Path">
                                    @f.Text
                                </label>

                                <div class="dropdown">
                                    <button class="btn btn-link btn-sm" type="button" data-bs-toggle="dropdown">
                                        ⋮
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" onclick="showRenameFileModal('@f.Path/@f.Text','@f.Text',@j)" href="#">✏️Rename</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" onclick="removeFile('@f.Path/@f.Text',@j)" href="#">🗑️Remove</a></li>
                                    </ul>
                                </div>
                            </td>
                            <td><small>@f.Length</small></td>
                        </tr>
                    }
      *@           
                </table>        
            </div>
            <div class="border-top" style="overflow: auto;position: absolute;padding: 0;
                                           left: 0;right: 0;bottom: 2px;">
                <span class="me-2"><strong class="me-2 total-file-count">@Model.files.Count</strong>items</span>|
                <span class="me-2">
                    @{
                        var Length = Model.files.Sum(x => x.LengthByte);
                    }
                    <strong class="total-file-size"> @(Length < 1024 ? $"{Length}" : Length < 1_000_000 ? $"{(long)(Length / 1024)}" : $"{(long)(Length / 1000000)}")</strong>
                    <span class="total-file-style">@(Length < 1024 ? $"B" : Length < 1_000_000 ? $"Kb" : $"Mb")</span>
                </span>
            </div>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" id="detailModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-1" id="showDetailModal" style="    min-height: 174px;">
            </div>
            @*<div class="modal-footer">
			</div> *@
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-1" id="showModal">
            </div>
            @*<div class="modal-footer">
			</div> *@
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" id="uploadModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body ">
                @Html.AntiForgeryToken()

                <div class="mb-3">
                    <input type="file" id="lastuploadFileInput" multiple class="form-control" />
                </div>

                <div class="mb-3 form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" name="change_img_format">
                    <label class="form-check-label" for="flexSwitchCheckDefault">change image format to .webp</label>
                </div>

                <div class="mb-3 form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" name="add_watermask_to_img">
                    <label class="form-check-label" for="flexSwitchCheckDefault">add watermask to image</label>
                    <img src="/watermask.png" />
                </div>

                <div class="mb-3 form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" name="make_sm_img_too">
                    <label class="form-check-label" for="make_sm_img_too">make_sm_img_too</label>
                </div>

                <button class="btn btn-primary" onclick="uploadfileToServer()">📤Upload File</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="/site.js"></script>
    <script>
        loadSub(-1,'/');
        function uploadfileToServer() {

            var e = $("#lastuploadFileInput")[0];
            var formData = new FormData();
            formData.append("__RequestVerificationToken", $("[name='__RequestVerificationToken']").val());
            formData.append("folder", _lastuploadFilePath.path);
            for (let i = 0; i < e.files.length; i++)
                formData.append(`formFile${i}`, e.files[i]);

            formData.append(`change_img_format`, $('[name=change_img_format]').is(':checked'));
            formData.append(`add_watermask_to_img`, $('[name=add_watermask_to_img]').is(':checked'));
            formData.append(`make_sm_img_too`, $('[name=make_sm_img_too]').is(':checked'));

            $.ajax({
                type: "POST",
                url: "@Html.Raw(Url.Action("Upload", baseurl))",
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (res) {
                    uploadModal.hide();
                    lastFolder="";
                    loadSub(_lastuploadFilePath.i0.replace("dir_",""), _lastuploadFilePath.path);
                    _lastuploadFilePath = "";
                    document.getElementById('lastuploadFileInput').value= null;
                }
            });
        }
    </script>
}


